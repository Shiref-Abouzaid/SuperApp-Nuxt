(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{585:function(t,e,o){"use strict";o.r(e);o(22),o(14),o(54),o(154),o(60),o(40),o(494),o(58);var r=o(21),n=o(95),c=o.n(n),l=o(16),m=o.n(l),d={name:"AllRooms",layout:"withoutNavbar",data:function(){return{pusher:null,auctionChannel:null,channelName:"",members:{},message:"",messages:[],selectedCover:!1,room:{},suggestedAdminRooms:[],sugesstedUserRooms:[],cover:"",roomName:"",attachType:"",attachUrl:"",attach:""}},fetch:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get("/my/rooms/"+t.$route.params.roomId);case 2:o=e.sent,console.log("room >> ",o.data.data),t.room=o.data.data.room,t.messages=o.data.data.room.posts,t.messages.reverse(),t.suggestedAdminRooms=o.data.data["suggested-admin-rooms"],t.sugesstedUserRooms=o.data.data["suggested-users-rooms"],t.scrollToBottomOfChat();case 10:case"end":return e.stop()}}),e)})))()},computed:{locale:function(){return this.$store.getters["locale/locale"]}},watch:{$route:function(t,e){this.$fetch(),this.scrollToBottomOfChat(),this.pusher&&this.pusher.unsubscribe(this.channelName),console.log("pusher in watch",this.pusher,this.channelName),this.initPusher()}},mounted:function(){this.scrollToBottomOfChat(),this.initPusher()},methods:{initPusher:function(){var t=this;console.log("in create >>>>>>>>>",this.channelName),this.pusher=new c.a("dpctgdv35p33t63d3eva",{encrypted:!1,cluster:"eu",forceTLS:!1,httpHost:"synchronizer.tbdm.net",statsHost:"http://synchronizer.tbdm.net/stats",wsHost:"synchronizer.tbdm.net",wsPort:6001,authEndpoint:"https://developers.api.tbdm.net/v-1872020/"+this.locale+"/my/group/"+this.$route.params.roomId+"/auth/presence",auth:{headers:{Authorization:this.$store.getters["auth/token"]}}}),console.log("auction route param id >> ",this.$route.params.roomId),this.channelName="presence-group."+this.$route.params.roomId,console.log("auction route param id >> ",this.$route.params.roomId,this.channelName),this.auctionChannel=this.pusher.subscribe("presence-group."+this.$route.params.roomId),console.log("auction channel",this.auctionChannel,this.auctionChannel.members),this.auctionChannel.bind("pusher:subscription_succeeded",(function(e){console.log("members >. ",e),delete e.members[t.$store.getters["auth/userId"]],t.members=e.members})),this.auctionChannel.bind("pusher:member_added",(function(e){console.log("members before >> ",t.members),console.log("member added >> ",e,e.id,e.info),t.members[+e.id]=e.info,console.log("all members >> ",t.members)}));var th=this;this.auctionChannel.bind("pusher:member_removed",(function(e){console.log("all members >> ",t.members,th.members),console.log("member removed >> ",e,t.members[e.id])}));var e=this,o=this.$store.getters["auth/userId"];this.auctionChannel.bind("App\\Events\\PublicGroupNewPost",(function(data){console.log("data >> ",data),console.log("data post >> ",data.post),data.post.user_id!=o&&(e.messages.push(data.post),e.scrollToBottomOfChat())}))},sendMessage:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o,r,n,c,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("message >> ",t.message,new Date),o=(new Date).toISOString().substring(0,10),r=(new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds(),console.log("date >. ",o+" "+r),e.prev=4,t.messages.push({attachment:{content:t.attachUrl,type:t.attachType},post_body:t.message,created_at:o+" "+r,user_id:t.$store.getters["auth/userId"],user_data:{image_url:null}}),console.log("messages log >> ",t.messages,t.attach),n=t.message,c=t.attach,t.message="",t.attach="",(l=new FormData).append("room_id",t.$route.params.roomId),l.append("user_id",t.$store.getters["auth/userId"]),l.append("post_body",n),l.append("attachment",c),e.next=18,m.a.post("/my/rooms/post-message",l,{headers:{Authorization:t.$store.getters["auth/token"],"content-Type":"multipart/form-data"}});case 18:d=e.sent,console.log("message sending >> ",d),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(4),console.log("send error >> ",e.t0);case 25:t.message="",t.scrollToBottomOfChat();case 27:case"end":return e.stop()}}),e,null,[[4,22]])})))()},scrollToBottomOfChat:function(){var t=this;setTimeout((function(){var e=t.$el.querySelector(".scrollable-box-messages");e.scrollTop=e.scrollHeight}),10)},loadMoreMessages:function(){this.$el.querySelector(".scrollable-box-messages").scrollTop<1?(console.log("should get more messages"),this.loading.moremessages=!0):this.loading.moremessages=!1},createRoom:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("room created"),o={name:t.roomName,creator_id:t.$store.getters["auth/userId"],image:t.cover},console.log("room info >> ",o),e.prev=3,e.next=6,m.a.post("/my/rooms/create",o);case 6:r=e.sent,t.$bvModal.hide("creatGroup"),console.log("room creted >> ",r),t.$router.push("/"+t.locale+"/social/rooms/"+r.data.data.id),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),console.log("error >> ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[3,12]])})))()},deleteRoom:function(){console.log("room deleted")},onImagePicked:function(t){var e=this;console.log("picked");var o=t.target.files[0];if(o){var r=new FileReader;r.addEventListener("load",(function(){e.cover=r.result,console.log("base 64 >> ",e.cover),e.selectedCover=!0})),r.readAsDataURL(o)}else this.cover=""},onFileSelected:function(t){var e=t.target.files[0],o=window.URL.createObjectURL(e);console.log("picked",o),this.attachUrl=o,this.attach=e,e.type.match("image.*")?this.attachType="image":e.type.match("video.*")&&(this.attachType="video"),console.log("file >> ",this.attach)},removePhoto:function(){this.cover="",this.selectedCover=!1}},beforeDestroy:function(){console.log("destroyed >> ",this.pusher,this.channelName),this.pusher&&this.pusher.unsubscribe(this.channelName)}},v=o(39),component=Object(v.a)(d,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"social-chat"},[o("b-container",[o("b-row",{staticClass:"mt-3"},[o("b-col",{staticClass:"pr-sm-2 mb-sm-5",attrs:{sm:"3"}},[o("div",{staticClass:"chats-persons chat-box  h-100"},[o("div",{staticClass:"chat-header"},[o("b-row",[o("b-col",{attrs:{cols:"5"}},[o("div",{staticClass:"title"},[t._v("\n                                    Chats\n                                ")])]),t._v(" "),o("b-col",{attrs:{cols:"7"}},[o("div",{staticClass:"create-group",on:{click:function(e){return t.$bvModal.show("creatGroup")}}},[o("img",{attrs:{src:"/images/icons/svg/social-creat-group.svg",alt:"icnon"}}),t._v(" "),o("span",{staticClass:"bold"},[t._v("Create Room")])])])],1)],1),t._v(" "),o("div",{staticClass:"users-select room-chat-select"},[o("div",{staticClass:"mt-2"},[o("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.collapse-admin-rooms",modifiers:{"collapse-admin-rooms":!0}}],staticClass:"bg-secondary-opacity-1 d-flex admin-rooms color-secondary w-100 no-shadow",attrs:{variant:"default"}},[o("span",[t._v("Admin Rooms")]),t._v(" "),o("b-img",{staticClass:"icon",attrs:{src:"/images/icons/svg/social-arrow-bottom.svg",alt:"icon"}})],1),t._v(" "),o("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-admin-rooms"}},t._l(t.suggestedAdminRooms,(function(e){return o("nuxt-link",{key:e.id,attrs:{to:"/"+t.locale+"/social/rooms/"+e.id}},[o("div",{staticClass:"single-chat-room-select"},[t._v("\n                                        "+t._s(e.name)+"\n                                    ")])])})),1)],1),t._v(" "),o("div",{staticClass:"mt-2"},[o("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.collapse-users-rooms",modifiers:{"collapse-users-rooms":!0}}],staticClass:"bg-secondary-opacity-1 d-flex admin-rooms color-secondary w-100 no-shadow",attrs:{variant:"default"}},[o("span",[t._v("Users Rooms")]),t._v(" "),o("b-img",{staticClass:"icon",attrs:{src:"/images/icons/svg/social-arrow-bottom.svg",alt:"icon"}})],1),t._v(" "),o("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-users-rooms"}},t._l(t.sugesstedUserRooms,(function(e){return o("nuxt-link",{key:e.id,attrs:{to:"/"+t.locale+"/social/rooms/"+e.id}},[o("div",{staticClass:"single-chat-room-select"},[t._v("\n                                        "+t._s(e.name)+"\n                                    ")])])})),1)],1)])])]),t._v(" "),o("b-col",{attrs:{sm:"6"}},[o("div",{staticClass:"chat-box chat-messages-box mb-5"},[o("div",{staticClass:"chat-header"},[o("b-row",[o("b-col",{staticClass:"p-0",attrs:{cols:"10"}},[o("div",{staticClass:"title"},[t.room.image_url?o("img",{attrs:{src:t.room.image_url,alt:""}}):t._e(),t._v(" "),o("span",[t._v(t._s(t.room.name))])])]),t._v(" "),o("b-col",{staticClass:"tabs-container",attrs:{cols:"2"}},[o("div",{staticClass:"icon-container",on:{click:function(e){return t.$bvModal.show("roomSetting")}}})])],1)],1),t._v(" "),o("b-row",{staticClass:"flex-nowrap overflow-hidden"},[o("b-col",{staticClass:"scroll-container",attrs:{cols:"12"}},[o("div",{staticClass:"scrollable-box-messages"},t._l(t.messages,(function(e){return o("div",{key:e.id,staticClass:"chat-content"},[e.user_id!=t.$store.getters["auth/userId"]?o("div",{staticClass:"recived-message message-container"},[o("img",{staticClass:"profile-image",attrs:{src:e.user_data&&e.user_data.image_url?e.user_data.image_url:"/images/placeholder.jpg",alt:""}}),t._v(" "),o("div",{staticClass:"message"},[e.attachment?[e.attachment.content&&"image"==e.attachment.type?o("img",{attrs:{src:e.attachment.content,alt:"sent photo."}}):e.attachment.content&&"video"==e.attachment.type?o("video",{attrs:{width:"320",height:"240",controls:""}},[o("source",{attrs:{src:e.attachment.content,type:"video/mp4"}}),t._v(" "),t._v("\n                                                    Your browser does not support the video tag.\n                                                ")]):t._e()]:t._e(),t._v(" "),e.post_body?o("p",{staticClass:"m-0"},[t._v(t._s(e.post_body))]):t._e(),t._v(" "),o("div",{staticClass:"time"},[t._v("\n                                                "+t._s(t._f("moment")(e.created_at,"from","now"))+"\n                                            ")])],2)]):o("div",{staticClass:"sent-message message-container"},[o("div",{staticClass:"message"},[e.attachment?[e.attachment.content&&"image"==e.attachment.type?o("img",{attrs:{src:e.attachment.content,alt:"sent photo."}}):e.attachment.content&&"video"==e.attachment.type?o("video",{attrs:{width:"320",height:"240",controls:""}},[o("source",{attrs:{src:e.attachment.content,type:"video/mp4"}}),t._v(" "),t._v("\n                                                    Your browser does not support the video tag.\n                                                ")]):t._e()]:t._e(),t._v(" "),e.post_body?o("p",{staticClass:"m-0"},[t._v(t._s(e.post_body))]):t._e(),t._v(" "),o("div",{staticClass:"time"},[t._v("\n                                                "+t._s(t._f("moment")(e.created_at,"from","now"))+"\n                                            ")])],2)])])})),0),t._v(" "),o("div",{staticClass:"input-box"},[o("form",{on:{submit:function(e){return e.preventDefault(),t.sendMessage(e)}}},[o("b-input-group",{scopedSlots:t._u([{key:"prepend",fn:function(){return[o("b-input-group-text",[o("input",{attrs:{type:"file",hidden:"",id:"sendImg"},on:{change:function(e){return t.onFileSelected(e)}}}),t._v(" "),o("label",{staticClass:"m-0",attrs:{for:"sendImg"}},[o("b-img",{attrs:{src:"/images/icons/svg/social-image-gery.svg",alt:"icon"}})],1),t._v(" "),t.attach?o("div",{staticClass:"attach"},["image"==t.attachType?[o("img",{staticClass:"image",attrs:{src:t.attachUrl,alt:""}}),t._v(" "),o("img",{staticClass:"icon",staticStyle:{cursor:"pointer"},attrs:{src:"/images/icons/svg/reservation-remove.svg",alt:""}})]:"video"==t.attachType?[o("video",{staticClass:"video"},[o("source",{attrs:{src:t.attachUrl,type:"video/mp4"}}),t._v(" "),t._v("\n                                                            Your browser does not support the video tag.\n                                                        ")])]:t._e()],2):t._e()])]},proxy:!0}])},[t._v(" "),o("b-form-input",{attrs:{placeholder:"Type your message…"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),t._v(" "),o("b-input-group-append",[o("b-button",{attrs:{type:"submit",variant:"default"}},[t._v("Send")])],1)],1)],1)])])],1)],1)]),t._v(" "),o("b-col",{staticClass:"pl-sm-2",attrs:{sm:"3"}},[o("div",{staticClass:"chat-box chat-messages-box mb-5"},[o("div",{staticClass:"chat-header pl-0"},[o("div",{staticClass:"title pt-2"},[t._v("\n                            Active Users\n                        ")])]),t._v(" "),o("div",{staticClass:"active-users"},t._l(t.members,(function(e,r){return o("div",{key:r,staticClass:"user d-flex"},[o("div",{staticClass:"name"},[t._v(t._s(e.username))])])})),0)])])],1)],1),t._v(" "),o("b-modal",{attrs:{"content-class":"create-group-popup create-rooms-popup",id:"creatGroup",size:"lg",centered:""},scopedSlots:t._u([{key:"modal-title",fn:function(){return[o("div",{staticClass:"title"},[t._v("Create Room")])]},proxy:!0},{key:"modal-header-close",fn:function(){return[o("b-img",{staticClass:"close-icon",attrs:{src:"/images/icons/svg/social-close-btn.svg",alt:"icon"}})]},proxy:!0},{key:"modal-footer",fn:function(){return[o("b-button",{staticClass:"b-block text-center p-2 w-100 create-room-btn no-shadow mt-5 mb-0 mr-0 ml-0",attrs:{variant:"default"},on:{click:t.createRoom}},[t._v("\n                Create Public Room\n            ")])]},proxy:!0}])},[t._v(" "),t._v(" "),o("div",{staticClass:"form-container"},[o("b-form",[o("div",[o("label",{attrs:{for:"room-name"}},[t._v("Room Name")]),t._v(" "),o("b-form-input",{staticClass:"text-input",attrs:{id:"room-name",type:"text",placeholder:"Room Name"},model:{value:t.roomName,callback:function(e){t.roomName=e},expression:"roomName"}})],1),t._v(" "),o("div",{staticClass:"friends"},[o("div",{staticClass:"lable mb-2"},[t._v("Room Cover")]),t._v(" "),t.selectedCover?o("div",{staticClass:"selected-cover mb-3"},[o("b-img",{attrs:{src:t.cover,alt:"cover"}})],1):t._e(),t._v(" "),o("label",{staticClass:"w-100 bg-primary-opacity-1 p-2 color-primary d-flex text-center upload-photo",attrs:{for:"room-cover"}},[o("b-img",{attrs:{src:"/images/icons/svg/social-photo-cloud.svg",alt:"icon"}}),t._v(" "),t.selectedCover?t._e():o("span",[t._v("Upload Photo")]),t._v(" "),t.selectedCover?o("span",[t._v("Change Photo")]):t._e()],1),t._v(" "),o("input",{attrs:{id:"room-cover",hidden:"",type:"file"},on:{change:t.onImagePicked}}),t._v(" "),t.selectedCover?o("b-button",{staticClass:"remove font-weight-bold mt-4 bg-red-opacity-1 no-shadow color-red w-100 p-2",attrs:{variant:"default"},on:{click:t.removePhoto}},[t._v("\n                        Remove Photo\n                    ")]):t._e()],1)])],1)]),t._v(" "),o("b-modal",{attrs:{"content-class":"create-group-popup create-rooms-popup",id:"roomSetting",size:"lg",centered:""},scopedSlots:t._u([{key:"modal-title",fn:function(){return[o("div",{staticClass:"title"},[t._v("Room Setting")])]},proxy:!0},{key:"modal-header-close",fn:function(){return[o("b-img",{staticClass:"close-icon",attrs:{src:"/images/icons/svg/social-close-btn.svg",alt:"icon"}})]},proxy:!0},{key:"modal-footer",fn:function(){return[o("b-button",{staticClass:"b-block text-center p-2 w-100 delete-room-btn no-shadow mt-5 mb-0 mr-0 ml-0",attrs:{variant:"default"},on:{click:t.deleteRoom}},[t._v("\n                Delete Public Room\n            ")])]},proxy:!0}])},[t._v(" "),t._v(" "),o("div",{staticClass:"form-container"},[o("b-form",[o("div",[o("label",{attrs:{for:"room-name"}},[t._v("Room Name")]),t._v(" "),o("b-form-input",{staticClass:"text-input",attrs:{id:"room-name",type:"text",placeholder:"Room Name"}})],1),t._v(" "),o("div",{staticClass:"friends"},[o("div",{staticClass:"lable mb-2"},[t._v("Room Cover")]),t._v(" "),t.selectedCover?o("div",{staticClass:"selected-cover mb-3"},[o("b-img",{attrs:{src:"https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2016/04/tinder-social-fail.png?w=780&h=408&crop=1",alt:"cover"}})],1):t._e(),t._v(" "),o("label",{staticClass:"w-100 bg-primary-opacity-1 p-2 color-primary d-flex text-center upload-photo",attrs:{for:"room-cover"}},[o("b-img",{attrs:{src:"/images/icons/svg/social-photo-cloud.svg",alt:"icon"}}),t._v(" "),t.selectedCover?t._e():o("span",[t._v("Upload Photo")]),t._v(" "),t.selectedCover?o("span",[t._v("Change Photo")]):t._e()],1),t._v(" "),o("input",{attrs:{id:"room-cover",hidden:"",type:"file"}}),t._v(" "),t.selectedCover?o("b-button",{staticClass:"remove font-weight-bold mt-4 bg-red-opacity-1 no-shadow color-red w-100 p-2",attrs:{variant:"default"}},[t._v("\n                        Remove Photo\n                    ")]):t._e()],1)])],1)])],1)}),[],!1,null,null,null);e.default=component.exports}}]);